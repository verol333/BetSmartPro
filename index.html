<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>BetSmart Pro</title>
    
    <!-- Scripts nécessaires -->
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.x.x/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.x.x/firebase-database-compat.js"></script>
    <script src="https://apis.google.com/js/platform.js" async defer></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">

    <!-- Configuration Firebase -->
    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyCigxBJ9Ot8-11S062n-PGiSM1uO98wE7g",
            authDomain: "betsmart-pro-55488.firebaseapp.com",
            databaseURL: "https://betsmart-pro-55488-default-rtdb.europe-west1.firebasedatabase.app",
            projectId: "betsmart-pro-55488",
            storageBucket: "betsmart-pro-55488.firebasestorage.app",
            messagingSenderId: "215633988518",
            appId: "1:215633988518:web:6342fa5daa5482a4265d67",
            measurementId: "G-623SHSQMRL"
        };

        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();
    </script>

    <style>
        /* Styles de base */
        :root {
            --primary-color: #3B3BF9;
            --secondary-color: #1BFFFF;
            --white: #FFFFFF;
            --text-dark: #1A1A1A;
            --text-light: #6B7280;
            --shadow: rgba(0, 0, 0, 0.1);
            --success-color: #4ADE80;
            --error-color: #EF4444;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
        }

        body {
            background: var(--white);
            color: var(--text-dark);
            line-height: 1.6;
        }

        /* Styles de la page de vérification */
        .verification-container {
            max-width: 600px;
            margin: 0 auto;
            padding: 20px;
            text-align: center;
        }

        .verification-header {
            margin-bottom: 30px;
        }

        .verification-title {
            font-size: 24px;
            font-weight: 700;
            color: var(--text-dark);
            margin-bottom: 10px;
        }

        .verification-subtitle {
            color: var(--text-light);
            font-size: 16px;
        }

        .verification-steps {
            margin-top: 30px;
        }

        .verification-step {
            background: var(--white);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 15px;
            box-shadow: 0 4px 15px var(--shadow);
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .step-icon {
            width: 40px;
            height: 40px;
            border-radius: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            background: var(--primary-color);
            color: var(--white);
        }

        .step-content {
            flex: 1;
            text-align: left;
        }

        .step-title {
            font-weight: 600;
            margin-bottom: 5px;
        }

        .step-description {
            font-size: 14px;
            color: var(--text-light);
        }

        .subscribe-button {
            background: var(--primary-color);
            color: var(--white);
            padding: 10px 20px;
            border-radius: 8px;
            border: none;
            font-size: 14px;
            cursor: pointer;
            transition: transform 0.2s ease;
            text-decoration: none;
            display: inline-block;
            margin-top: 10px;
        }

        .subscribe-button:hover {
            transform: translateY(-2px);
        }

        .status-icon {
            width: 24px;
            height: 24px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            margin-left: auto;
        }

        .status-icon.pending {
            background: var(--text-light);
            color: var(--white);
        }

        .status-icon.success {
            background: var(--success-color);
            color: var(--white);
        }

        .verify-button {
            background: linear-gradient(45deg, var(--primary-color), var(--secondary-color));
            color: var(--white);
            padding: 15px 30px;
            border-radius: 12px;
            border: none;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            margin-top: 30px;
            transition: transform 0.2s ease;
            display: none;
        }

        .verify-button.active {
            display: inline-block;
        }

        .verify-button:hover {
            transform: translateY(-2px);
        }

        /* Animation de chargement */
        .loading-spinner {
            width: 24px;
            height: 24px;
            border: 3px solid var(--text-light);
            border-top: 3px solid var(--primary-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
</style>
</head>
<body>
    <!-- Page de vérification -->
    <div class="verification-container" id="verification-page">
        <div class="verification-header">
            <h1 class="verification-title">Bienvenue sur BetSmart Pro</h1>
            <p class="verification-subtitle">Veuillez vous abonner pour accéder à l'application</p>
        </div>

        <div class="verification-steps">
            <div class="verification-step" id="telegram-step">
                <div class="step-icon">
                    <i class="fab fa-telegram"></i>
                </div>
                <div class="step-content">
                    <div class="step-title">Canal Telegram</div>
                    <div class="step-description">Rejoignez notre canal Telegram pour les dernières mises à jour</div>
                    <a href="https://t.me/alvecapital1" target="_blank" class="subscribe-button">
                        Rejoindre le canal
                    </a>
                </div>
                <div class="status-icon pending" id="telegram-status">
                    <i class="fas fa-spinner"></i>
                </div>
            </div>

            <div class="verification-step" id="youtube1-step">
                <div class="step-icon">
                    <i class="fab fa-youtube"></i>
                </div>
                <div class="step-content">
                    <div class="step-title">Chaîne YouTube 1</div>
                    <div class="step-description">Abonnez-vous à notre première chaîne YouTube</div>
                    <a href="https://youtube.com/@alvecapital" target="_blank" class="subscribe-button">
                        S'abonner
                    </a>
                </div>
                <div class="status-icon pending" id="youtube1-status">
                    <i class="fas fa-spinner"></i>
                </div>
            </div>

            <div class="verification-step" id="youtube2-step">
                <div class="step-icon">
                    <i class="fab fa-youtube"></i>
                </div>
                <div class="step-content">
                    <div class="step-title">Chaîne YouTube 2</div>
                    <div class="step-description">Abonnez-vous à notre seconde chaîne YouTube</div>
                    <a href="https://youtube.com/@AlexVerol2" target="_blank" class="subscribe-button">
                        S'abonner
                    </a>
                </div>
                <div class="status-icon pending" id="youtube2-status">
                    <i class="fas fa-spinner"></i>
                </div>
            </div>
        </div>

        <button id="verify-button" class="verify-button" onclick="verifySubscriptions()">
            Vérifier les abonnements
        </button>
    </div>

    <!-- Application principale (initialement cachée) -->
    <div id="main-app" style="display: none;">
        <!-- Le contenu principal de l'application ici -->
    </div>

    <script>
        let tg = window.Telegram.WebApp;
        tg.expand();

        // Configuration
        const TELEGRAM_CHANNEL = 'alvecapital1';
        const YOUTUBE_CHANNEL1 = '@alvecapital';
        const YOUTUBE_CHANNEL2 = '@AlexVerol2';

        // État des vérifications
        let subscriptionStatus = {
            telegram: false,
            youtube1: false,
            youtube2: false
        };

        // Fonction pour mettre à jour le statut d'un step
        function updateStepStatus(stepId, status) {
            const statusElement = document.getElementById(`${stepId}-status`);
            if (status === 'loading') {
                statusElement.innerHTML = '<div class="loading-spinner"></div>';
                statusElement.className = 'status-icon pending';
            } else if (status === 'success') {
                statusElement.innerHTML = '<i class="fas fa-check"></i>';
                statusElement.className = 'status-icon success';
            } else {
                statusElement.innerHTML = '<i class="fas fa-times"></i>';
                statusElement.className = 'status-icon error';
            }
        }

        // Fonction pour vérifier les abonnements
        async function verifySubscriptions() {
            const verifyButton = document.getElementById('verify-button');
            verifyButton.disabled = true;
            
            // Vérification Telegram
            updateStepStatus('telegram', 'loading');
            try {
                const telegramStatus = await checkTelegramSubscription();
                subscriptionStatus.telegram = telegramStatus;
                updateStepStatus('telegram', telegramStatus ? 'success' : 'error');
            } catch (error) {
                updateStepStatus('telegram', 'error');
            }

            // Vérification YouTube 1
            updateStepStatus('youtube1', 'loading');
            try {
                const youtube1Status = await checkYouTubeSubscription(YOUTUBE_CHANNEL1);
                subscriptionStatus.youtube1 = youtube1Status;
                updateStepStatus('youtube1', youtube1Status ? 'success' : 'error');
            } catch (error) {
                updateStepStatus('youtube1', 'error');
            }

            // Vérification YouTube 2
            updateStepStatus('youtube2', 'loading');
            try {
                const youtube2Status = await checkYouTubeSubscription(YOUTUBE_CHANNEL2);
                subscriptionStatus.youtube2 = youtube2Status;
                updateStepStatus('youtube2', youtube2Status ? 'success' : 'error');
            } catch (error) {
                updateStepStatus('youtube2', 'error');
            }

            verifyButton.disabled = false;

            // Si tout est vérifié, accès à l'application
            if (subscriptionStatus.telegram && subscriptionStatus.youtube1 && subscriptionStatus.youtube2) {
                setTimeout(() => {
                    document.getElementById('verification-page').style.display = 'none';
                    document.getElementById('main-app').style.display = 'block';
                    initMainApp();
                }, 1000);
            }
        }
        // Fonction pour vérifier l'abonnement Telegram
        async function checkTelegramSubscription() {
            try {
                const response = await fetch(`https://api.telegram.org/bot${BOT_TOKEN}/getChatMember`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        chat_id: `@${TELEGRAM_CHANNEL}`,
                        user_id: tg.initDataUnsafe.user.id
                    })
                });

                const data = await response.json();
                return ['member', 'administrator', 'creator'].includes(data.result.status);
            } catch (error) {
                console.error('Erreur vérification Telegram:', error);
                return false;
            }
        }

        // Fonction pour vérifier l'abonnement YouTube
        async function checkYouTubeSubscription(channelId) {
            // Note: Cette vérification nécessite une configuration côté serveur
            // car l'API YouTube ne permet pas la vérification directe des abonnements
            // Pour le moment, on simule la vérification
            return new Promise(resolve => {
                setTimeout(() => {
                    resolve(true);
                }, 1500);
            });
        }

        // Gestionnaire de base de données Firebase
        class DatabaseManager {
            constructor() {
                this.db = firebase.database();
            }

            async saveUserAccess(telegramId) {
                const userRef = this.db.ref(`users/${telegramId}`);
                const now = new Date();
                const resetTime = new Date();
                resetTime.setHours(24, 0, 0, 0);

                await userRef.set({
                    dailyRequests: 0,
                    lastAccess: now.getTime(),
                    nextReset: resetTime.getTime(),
                    requestsLimit: 5
                });
            }

            async updateUserRequests(telegramId) {
                const userRef = this.db.ref(`users/${telegramId}`);
                const snapshot = await userRef.once('value');
                const userData = snapshot.val();

                if (new Date().getTime() >= userData.nextReset) {
                    // Reset quotidien
                    const resetTime = new Date();
                    resetTime.setHours(24, 0, 0, 0);

                    await userRef.update({
                        dailyRequests: 1,
                        lastAccess: new Date().getTime(),
                        nextReset: resetTime.getTime()
                    });
                    return true;
                } else if (userData.dailyRequests < userData.requestsLimit) {
                    // Incrémenter le compteur
                    await userRef.update({
                        dailyRequests: userData.dailyRequests + 1,
                        lastAccess: new Date().getTime()
                    });
                    return true;
                }

                return false;
            }

            async getRemainingRequests(telegramId) {
                const snapshot = await this.db.ref(`users/${telegramId}`).once('value');
                const userData = snapshot.val();
                
                if (new Date().getTime() >= userData.nextReset) {
                    return userData.requestsLimit;
                }
                
                return userData.requestsLimit - userData.dailyRequests;
            }
        }

        const dbManager = new DatabaseManager();

        // Initialisation de l'application principale
        async function initMainApp() {
            if (tg.initDataUnsafe?.user?.id) {
                await dbManager.saveUserAccess(tg.initDataUnsafe.user.id);
                loadMainContent();
            }
        }

        // Vérifie périodiquement les abonnements
        setInterval(() => {
            if (document.getElementById('main-app').style.display === 'block') {
                verifySubscriptions();
            }
        }, 300000); // Vérification toutes les 5 minutes

        // Initialisation
        document.addEventListener('DOMContentLoaded', () => {
            verifySubscriptions();
        });

        tg.ready();
    </script>
</body>
</html>
